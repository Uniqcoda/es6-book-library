var database = require('../app_methods/database');

function Book(name, author, totalQuantity) {
  this.name = name;
  this.author = author;
  this.totalQuantity = totalQuantity;
  // the book Id will be autogenerated and will increment based on the Id of the most recent book in the database
  this.bookId = database.books.length ? database.books[database.books.length - 1].booksId + 1 : 1;
  this.borrowers = [];
  this.quantityAvailable = this.totalQuantity - this.borrowers.length;
  database.books.push(this);
}

Book.createBook = function (name, author, totalQuantity) {
  return new Book(name, author, totalQuantity);
}

Book.searchBook = function (name) {
  var booksWithName = [];
  for (var index = 0; index < database.books.length; index++) {
    if (database.books[index].name === name) {
      var bookName = database.books[index].name;
      var bookAuthor = database.books[index].author;
      booksWithName.push({ name: bookName, author: bookAuthor });
    }
  }
  if (booksWithName.length) return booksWithName;
  return 'Invalid id';
}

Book.updateBook = function (bookId, updateDetails) {
  for (var index = 0; index < database.books.length; index++) {
    if (database.books[index].bookId === bookId) {
      return database.books[index].totalQuantity = updateDetails.totalQuantity;
    }
  }
  return 'Invalid id';
}

Book.deleteBook = function (bookId) {
  for (var index = 0; index < database.books.length; index++) {
    if (database.books[index].bookId === bookId) {
      database.books.splice(index,1);
      return 'Book successfully deleted'
    }
  }
  return 'Invalid id';
}

Book.readABook = function (bookId) {
  for (var index = 0; index < database.books.length; index++) {
    if (database.books[index].bookId === bookId) {
      return database.books[index];
    }
  }
  return 'Invalid id';
}

Book.readAllBooks = function () {
  return database.books;
}
module.exports = Book;